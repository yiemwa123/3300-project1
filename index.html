<!DOCTYPE html>
<html lang="en"><meta charset="UTF-8">

<head>
    <style>
        .yGrid line {
            stroke: lightgrey;
        }

        .yGrid .domain {
            display: none;
        }
    </style>

    <title>Project 1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>

</head>

<body>
    <div style = "margin-left: 50px;"><p>Graph 1 </p><svg id="graph1"></svg>



    <svg id="graph2" width="650" height="500"></svg>

    <svg id="graph3" width="650" height="500"></svg>


    <svg id="graph4" width="650" height="500"></svg>


        <script>
            const width = 650;
            const height = 500;
            const margins = 30;
            const chartH = 440;
            const chartW = 590;



            d3.csv("athletes.csv", d3.autoType).then( (data) => {

                let obj = d3.select('svg#graph1');

                //left
                let tickers = obj.append('g')
                                 .attr("id", "tickers");

                let medalData = [];

                let nonMedalData=[];


                data.forEach(d => {
                    //Filter out non-medalists
                    if(d.silver + d.gold + d.bronze > 0 && d.height>0) {
                        medalData.push(d);
                    } else if (d.height>0){
                      nonMedalData.push(d);
                    } else{
                    }
                })

                obj.attr('width', width)
                   .attr('height', height);

                let heightExtent = d3.extent(medalData, d=> d.height);

                let maxGold = d3.max(data, (d) => {return Math.max(d.gold)});
                let maxSilver = d3.max(data, (d) => {return Math.max(d.silver)});
                let maxBronze = d3.max(data, (d) => {return Math.max(d.bronze)});

                const medalExtent = [0, Math.max(maxGold, maxSilver, maxBronze)];

                // let heightScale = d3.scaleLinear().domain(heightExtent).range([0, width-2*margins]);
                // const medalScale = d3.scaleLinear().domain(medalExtent).range([height-2*margins, 0]);

                console.log(heightExtent);

                let heightScale = d3.scaleLinear().domain([heightExtent[0]-0.05, heightExtent[1]+0.05]).range([height-2*margins, 0]);
                const medalScale = d3.scaleLinear().domain(medalExtent).range([0, width-2*margins]);


                console.log(heightExtent);
                //Calculate


                // //Y Axis
                //
                // let y = d3.axisLeft(medalScale).tickFormat(d3.format('.0f')).ticks(6);
                // let yGrid = d3.axisLeft(medalScale)
                //               .tickFormat("")
                //               .tickSize(-width + margins);
                //
                //
                //
                // tickers.append('g')
                //         .attr("class", "tickerss")
                //         .attr("transform", `translate(25, 30)`)
                //         .call(y);
                //
                // tickers.append('g')
                //        .attr("class", "yGrid")
                //        .attr("transform", `translate(25, 30)`)
                //        .call(yGrid);
                //
                // //X Axis
                // let x = d3.axisBottom(heightScale);
                // let xGrid = d3.axisBottom(heightScale)
                //               .tickFormat("")
                //               .tickSize(-height + margins);
                //
                // tickers.append('g')
                //         .attr("class", "tickerss")
                //         .attr("transform", `translate(30, 480)`)
                //         .call(x);
                //
                // tickers.append('g')
                //        .attr("class", "yGrid")
                //        .attr("transform", `translate(30, 480)`)
                //        .call(xGrid);




                //Y Axis

                let y = d3.axisLeft(heightScale);
                let yGrid = d3.axisLeft(heightScale)
                              .tickFormat("")
                              .tickSize(-width + margins);



                tickers.append('g')
                        .attr("class", "tickerss")
                        .attr("transform", `translate(25, 30)`)
                        .call(y);

                tickers.append('g')
                       .attr("class", "yGrid")
                       .attr("transform", `translate(25, 30)`)
                       .call(yGrid);

                //X Axis
                let x = d3.axisBottom(medalScale).tickFormat(d3.format('.0f')).ticks(6);
                let xGrid = d3.axisBottom(medalScale)
                              .tickFormat("")
                              .tickSize(-height + 2*margins);

                tickers.append('g')
                        .attr("class", "tickerss")
                        .attr("transform", `translate(30, 470)`)
                        .call(x);

                tickers.append('g')
                       .attr("class", "yGrid")
                       .attr("transform", `translate(30, 470)`)
                       .call(xGrid);

                //Chart Area
                let chart = obj.append('g')
                               .attr("id", "chart")
                               .attr("transform", `translate(30, 30)`)
                               .style("fill", "black");

                //Circles

                function jitter() {
                    return Math.random()*20-10;
                }
                console.log(medalData);

                const medType = ["gold", 'silver', 'bronze'];
                const medCol = ['gold', 'silver', '#CD7F32'];

                // medalData.forEach((d) => {
                //     medType.forEach((n, i) => {
                //         if (d[n] > 0) {
                //             chart.append("circle")
                //                  .attr('cx', heightScale(d.height))
                //                  .attr("cy", medalScale(d[n])+jitter())
                //                  .attr('r', 5)
                //                  .attr('opacity', 0.6)
                //                  .style('fill', medCol[i]);
                //                  // .style('stroke-width',0.5)
                //                  // .style('stroke', 'black');
                //         }
                //     });
                //
                //
                // });


                medalData.forEach((d) => {
                    medType.forEach((n, i) => {
                        if (d[n] > 0) {
                            chart.append("circle")
                                 .attr('cx', d[n] > 2 ? medalScale(d[n]) : medalScale(d[n])+jitter())
                                 .attr("cy", heightScale(d.height))
                                 .attr('r', 5)
                                 .attr('opacity', 0.7)
                                 .style('fill', medCol[i]);
                                 // .style('stroke-width',0.5)
                                 // .style('stroke', 'black');
                        }
                    });


                });





                let maleSportData=[];

                let femaleSportData=[];


                function selectedSport(string){
                  return (string==='gymnastics' || string==='basketball'
                  || string==='shooting'
                  || string==='weightlifting'
                  || string==='badminton'
                  || string==='sailing')};




                data.forEach((d)=>{
                  if (d.sex==='female' && selectedSport(d.sport)){
                    femaleSportData.push(d);
                  };

                  if (d.sex==='male' && selectedSport(d.sport)){
                    maleSportData.push(d);
                  };

                });

                let nonMaleSportData=[];

                let nonFemaleSportData=[];

                //
                // nonMedalData.forEach((d)=>{
                //   if (d.sex==='female' && selectedSport(d.sport)){
                //     nonFemaleSportData.push(d);
                //   };
                //
                //   if (d.sex==='male' && selectedSport(d.sport)){
                //     nonMaleSportData.push(d);
                //   };
                //
                // });



            // generate the svg for both genders, female, male

            let svg2 = d3.select('svg#graph2');
            let svg3 = d3.select('svg#graph3');
            let svg4 = d3.select('svg#graph4');





            //function for generating bar graphs
            function medianHeight(dataset, svg){




              // save medal medians to find extent
              let medalMedians=[];



              // create new dataset that saves median height for each medal category for each sport
              let newData=[];


              let sports_array=['gymnastics', "basketball", "shooting", "weightlifting", "badminton", "sailing"];

              sports_array.forEach(string=>{




                // get the relevant sports

                let sport_data=dataset.filter(d=>{return d.sport===string});




                // separate gold, silver, and bronze data
                let goldData=sport_data.filter(d=>{return d.gold>0});

                let silverData=sport_data.filter(d=>{return d.silver>0});

                let bronzeData=sport_data.filter(d=>{return d.bronze>0});

                let nonMedal=sport_data.filter(d=>{return (d.gold===0 && d.silver===0 && d.bronze===0);});





                // find median height for gold silver and bronze
                let goldMedian=d3.median(goldData, d=>d.height);
                let silverMedian=d3.median(silverData, d=>d.height);
                let bronzeMedian=d3.median(bronzeData, d=>d.height);

                let nonMedalMedian=d3.median(nonMedal,d=>d.height);







                // store info by creating object and storing info there
                let object=new Object();

                object.sport=string;

                object.gold=goldMedian;
                object.silver=silverMedian;
                object.bronze=bronzeMedian;
                object.nonmedal=nonMedalMedian;


                // add it to the dataset
                newData.push(object);



                // collect all the medians
                medalMedians.push(goldMedian);
                medalMedians.push(silverMedian);
                medalMedians.push(bronzeMedian);
                medalMedians.push(nonMedalMedian);


              });








            let newMargin = 66;




           const maxMedian=d3.max(medalMedians);
           const ChartMin = 1.4;

           heightScale = d3.scaleLinear().domain([ChartMin,maxMedian+0.05]).range([420,0]);

           let axis = svg.append('g').attr('id', 'yAxis2');
           let yAxis = d3.axisLeft(heightScale);

           axis.append('g')
                 .attr('class', "yAxis")
                 .attr("transform", `translate(30, 40)`)
                 .call(yAxis);

           let yGrid = d3.axisLeft(heightScale)
                         .tickFormat('')
                         .tickSize(-740);

           axis.append('g')
                 .attr('class', "yGrid")
                 .attr("transform", `translate(30, 40)`)
                 .call(yGrid);


           // const sports=d3.map(sportss);
           const sportScale=d3.scaleBand().domain(sports_array).range([0, 570]).padding(0.15);

           let x = d3.axisBottom(sportScale);
           let xGrid = d3.axisBottom(sportScale)
                         .tickFormat("")
                         .tickSize(-height + newMargin);

           axis.append('g')
                   .attr("class", "tickerss")
                   .attr("transform", `translate(40, 470)`)
                   .call(x);

           axis.append('g')
                  .attr("class", "yGrid")
                  .attr("transform", `translate(40, 470)`)
                  .call(xGrid);

           let chartArea = svg.append('g')
                              .attr("id", "chart2")
                              .attr("transform", `translate(40, 40)`);

           newData.forEach(d=>{

             chartArea.append('rect').attr('fill', 'gold').attr("x", sportScale(d.sport)).attr("y", heightScale(d.gold))
             .attr("height",heightScale(ChartMin)-heightScale(d.gold)).attr("width", sportScale.bandwidth()/4);
             chartArea.append('rect').attr('fill', 'silver').attr("x", sportScale(d.sport)+sportScale.bandwidth()/4).attr("y", heightScale(d.silver)).attr("height",heightScale(ChartMin)-heightScale(d.silver)).attr("width", sportScale.bandwidth()/4)
             chartArea.append('rect').attr('fill', '#CD7F32').attr("x", sportScale(d.sport)+sportScale.bandwidth()*2/4).attr("y", heightScale(d.bronze)).attr("height",heightScale(ChartMin)-heightScale(d.bronze)).attr("width", sportScale.bandwidth()/4)
             chartArea.append('rect').attr('fill', 'grey').attr("x", sportScale(d.sport)+sportScale.bandwidth()*3/4).attr("y", heightScale(d.nonmedal)).attr("height",heightScale(ChartMin)-heightScale(d.nonmedal)).attr("width", sportScale.bandwidth()/4)


           });

       };


       medianHeight(data, svg2);
       svg2.append("text").text("Median height for both genders").attr("x", 250).attr("y", 20).style('font-size', "15px").style('font-weight', 'bold').style('font-family', 'sans-serif');
       medianHeight(femaleSportData, svg3);
       svg3.append("text").text("Median height for female athletes").attr("x", 250).attr("y", 20).style('font-size', "15px").style('font-weight', 'bold').style('font-family', 'sans-serif');
       medianHeight(maleSportData, svg4);
       svg4.append("text").text("Median height for male athletes").attr("x", 250).attr("y", 20).style('font-size', "15px").style('font-weight', 'bold').style('font-family', 'sans-serif');









     });














        </script>


    </div>

</body>
</html>
